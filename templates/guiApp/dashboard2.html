{% extends "guiApp/layout.html" %}

{% block content %}

	<h1>Dashboard</h1>
	{% if commands %}
	<div class="row">
		<div class="well">
			<div class="row">
				<div class="col-md-6 text-center">
					<div class="alert alert-danger" role="alert">
						<b>No data feed detected</b>
					</div>
				</div>
				<div class="col-md-6">
					<h4>Tube stats</h4>
					<div class="progress">
						<div class="progress-bar progress-bar-warning output_tube_temperature" role="progressbar" aria-valuenow="60"
						aria-valuemin="0" aria-valuemax="100" style="width:50%">
						
						</div>
						Tube temperature (<span class="label_output output_tube_temperature">15</span> C)
					</div>

					<div class="progress">
						<div class="progress-bar progress-bar-info output_tube_pressure" role="progressbar" aria-valuenow="40"
						aria-valuemin="0" aria-valuemax="100" style="width:5%">
						
						</div>
						Tube pressure (<span class="label_output output_tube_pressure">100</span> Pa)
					</div>

					<h4>Pod stats</h4>
					<div class="progress">
						<div class="progress-bar progress-bar-warning output_pod_temperature" role="progressbar" aria-valuenow="60"
						aria-valuemin="0" aria-valuemax="100" style="width:60%" >
						
						</div>
						Pod temperature (<span class="label_output output_pod_temperature">20</span> C)
					</div>

					<div class="progress">
						<div class="progress-bar progress-bar-info output_pod_pressure" role="progressbar" aria-valuenow="40"
						aria-valuemin="0" aria-valuemax="100" style="width:40%">
						
						</div>
						Pod pressure (<span class="label_output output_pod_pressure">800</span> Pa)
					</div>
					
					<p><b>Speed:</b> <span class="label_output output_speed">200</span>m/s</p>
					<p><b>Position(x, y, z):</b> <span class="label_output output_position">1002.6, 2556.1, 12.5</span></p>
					<p><b>Position(distance from start):</b> <span class="label_output output_distance">500.6</span>m </p>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="well">
			<legend>Controls</legend>
			<div class="row">
				<div class="col-md-6">
					<button type="button" data-command="{{commands.1.name}}" class="btn btn-success btn-block ">{{commands.1.name}}</button>
				</div>
				<div class="col-md-6">
					<button type="button" data-command="{{commands.0.name}}" class="btn btn-danger btn-block progress-bar-danger progress-bar-striped">{{commands.0.name}}</button>
				</div>
			</div>
			<br>
			<div class="row">
				<div class="col-md-6">
					<div class="input-group input-group-lg">
						<span class="input-group-addon" id="sizing-addon1">{{commands.2.name}}</span>
						<input type="text" class="form-control" placeholder="{{commands.2.arguments.0}}" aria-describedby="sizing-addon1">
						<span class="input-group-btn">
					        <button class="btn btn-default" data-command="{{commands.2.name}}" type="button">Send</button>
					    </span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="well">
			<legend>Commands</legend>
			{% for command in commands %}
				{% if "start" != command.name and "stop" != command.name and "move" != command.name %}
				<div class="row">
					<div class="col-md-6">
						<div class="input-group input-group-lg">
							<span class="input-group-addon" id="sizing-addon1">{{command.name}}</span>
							{% for argument in command.arguments %}
								<input type="text" class="form-control" placeholder="{{argument}}" aria-describedby="sizing-addon1">
							{% endfor %}
							<span class="input-group-btn">
						        <button class="btn btn-default" data-command="{{command.name}}" type="button">Send</button>
						    </span>
						</div>
					</div>
				</div>
				{% endif %}
			{% endfor %}
		</div>
	</div>
{% else%}
	<div class="alert alert-danger" role="alert">Could not connect to wifi node</div>
{% endif %}

<script type="text/javascript">
	$(function () {
	    $.ajaxSetup({
	        headers: { "X-CSRFToken": getCookie("csrftoken") }
	    });
	});


	//---------------------------------------//
	// Outputs
	//---------------------------------------//








	//---------------------------------------//
	// Buttons
	//---------------------------------------//
	$("button").on("click", function(){
		var command = $(this).data('command'),
			$inputs = $(this).parent().parent().find("input[type='text']"),
			arguments_ = [];

		$inputs.each(function(){
			arguments_.push( $(this).val() );
		});

        $.ajax({
            type: "POST",
            url: '/' + command,
            error: function (request, error) {
                console.log(error);
            },
            data: {"args[]":arguments_},
    		dataType: 'jsonp',
            success: successFunc,
            failure: failureFunc,
            dataType: 'html',
            timeout: 3000
        });
    });

	// Use this function to do stuff if milestone update is successful
    function successFunc(data, textStatus, jqXHR) {
        console.log(data)
    }
    // Use this function to do stuff if not successful. For example show validation messages?
    function failureFunc(data, textStatus, jqXHR) {
        console.log(data)
    }

</script>

{% endblock %}
